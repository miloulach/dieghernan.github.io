---
layout: post
title: "Quick R: Inset maps"
subtitle: "An alternative using plot()"
tags: [R, maps, flags,sf]
date: 2019-11-08
share-img: https://dieghernan.github.io/assets/figs/20190618_imgpost-1.png
img-to-head: true
linktormd: true
output: github_document
---




```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(global.par = TRUE)
rm(list = ls())


```


How to place an inset map in **R**? There are many solutions out there using the `ggplot2`package (see [Drawing beautiful maps programmatically with R, sf and ggplot2](https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-3.html) by Mel Moreno and Mathieu Basille). However, I like the old reliable `plot` function, so the question is: is there another way?


There is. I found inspiration [here](https://www.statmethods.net/advgraphs/layout.html) and I just applied it to a map.


### Required R packages

```{r libs, warning=FALSE, message=FALSE, tidy='styler'}
library(sf)
library(dplyr)
library(rnaturalearth)
```

### Mimicking Moreno & Basille

I would present here an alternative version of [Drawing beautiful maps programmatically with R, sf and ggplot2](https://www.r-spatial.org/r/2018/10/25/ggplot2-sf-3.html), so the bulk of the detail can be found there. I would focus only in the `plot()`side.

```{r 20191108_main, fig.align='center', message=FALSE, warning=FALSE, dpi=90, paged.print=FALSE, tidy='styler', results='hide',fig.width=500/90, fig.height=300/90}
world <- ne_countries(scale='medium',returnclass = 'sf')
USA <- subset(world, admin == "United States of America")

# Plot mainland USA----
par(mar = c(0, 0, 0, 0))
plot(
  st_geometry(USA %>%
                st_transform(2163)),
  xlim = c(-2500000, 2500000),
  ylim = c(-2300000, 730000)
)
```

```{r 20191108_Alaska, fig.align='center', message=FALSE, warning=FALSE, dpi=90, paged.print=FALSE, tidy='styler', results='hide',fig.width=500/90, fig.height=300/90}
# Plot Alaska----
plot(
  st_geometry(USA %>%
                st_transform(3467)),
  xlim = c(-2400000, 1600000),
  ylim = c(200000, 2500000)
  )
```

```{r 20191108_Hawaii, fig.align='center', message=FALSE, warning=FALSE, dpi=90, paged.print=FALSE, tidy='styler', results='hide',fig.width=500/90, fig.height=300/90}
# Plot Hawaii----
plot(
  st_geometry(USA %>%
                st_transform(4135)),
  xlim = c(-161, -154),
  ylim = c(18, 23)
)
```

### Insetting

From now on, I just focus on the inset part, using the `fig()` option on `par()`. Quotting [statmethods](https://www.statmethods.net/advgraphs/layout.html):

>*(...) think of the full graph area as going from `(0,0)` in the lower left corner to `(1,1)` in the upper right corner. The format of the `fig=` parameter is a numerical vector of the form `c(x1, x2, y1, y2)`(...)
`fig=` starts a new plot, so to add to an existing plot use `new=TRUE`.*

So being `x1` and `y1` the starting points and `x2`, `y2` the final points, we just can set up those parameters and adjust the final placement of the insets. Additionally I added a box around the insets using `bbox()`. I didn't mimick Moreno & Basille here and I just worked it by myself.

```{r 20191108_inset, fig.align='center', message=FALSE, warning=FALSE, dpi=90, paged.print=FALSE, tidy='styler', results='hide',fig.width=500/90, fig.height=300/90}
par(mar=c(0,0,0,0))
plot(
  st_geometry(USA %>%
                st_transform(2163)),
  xlim = c(-2500000, 2500000),
  ylim = c(-2300000, 730000)
)
par(fig=c(0.05,0.26,0.05,0.30),
    new = TRUE)
plot(
  st_geometry(USA %>%
                st_transform(3467)),
  xlim = c(-2400000, 1600000),
  ylim = c(200000, 2500000)
)
box(which = "figure", lwd = 1)

par(fig=c(0.27,0.38,0.05,0.23),
    new = TRUE)
plot(
  st_geometry(USA %>%
                st_transform(4135)),
  xlim = c(-161, -154),
  ylim = c(18, 23)
)

box(which = "figure", lwd = 1)
```

Results may vary depending of the size of the original plot (Mainland USA) and your plotting device and output. However with a bit of trial-and-error it is quite easy to adjust the final result.


